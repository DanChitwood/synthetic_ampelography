# Synthetic Ampelography: Deep Learning for Vitis Leaf Classification and Vasculature Generation

## Methods 

### Convolutional Neural Network (CNN) classification using radial Euler Characteristic Transform (ECT) and aligned shape mask  
We begin by leaf shape as two distinct contours: the leaf blade and its primary venation network. These contours are converted into a set of pseudo-landmarks as previous described (Chitwood et al., 2025; https://doi.org/10.1002/ppp3.10561). These contours are normalized for size and position by Procrustean superimposition, then flattened into a single vector of coordinates. Principal Component Analysis (PCA) is applied to these vectors to create a low-dimensional morphospace that captures the primary shape variance of the real leaves. To address class imbalance and augment the dataset, a Synthetic Minority Over-sampling Technique (SMOTE) (Chawla et al., 2002; https://doi.org/10.1613/jair.953), in which a random distance between a sample and a neighbor of the same class in the PCA space is selected and used to generate an eigenleaf representation using the inverse transform, is used to generate new, synthetic leaf coordinate vectors.

For every real and synthetic leaf sample, four distinct image channels are generated. First, a binary shape mask is created for both the blade and venation contours. Second, the Euler Characteristic Transform (ECT) (Munch, 2024; https://doi.org/10.1080/00029890.2024.2409616) is calculated for both contours. This topological descriptor is computed by sweeping a line across each shape from a number of directions of different angles and at threshold positions along each angle. Treating a closed contour as an embedded graph, at each direction and threshold value the Euler characteristic (the number of vertices minus edges plus faces) is calcuated. The resulting Cartesian matrix (in which pixel values are the Euler characteristic value and the axes directions and thresholds) is converted into a polar coordinate representation that uses half the thresholds such that it can be aligned with the original shape mask from which it is derived.

The resulting four image channels (blade mask, blade ECT, venation mask, venation ECT) are stacked to form a single 4-channel image for each leaf. This dataset is used to train a convolutional neural network (CNN) in a 5-fold stratified cross-validation scheme. The training set for each fold consists of a mix of real and synthetic samples, while validation is performed exclusively on held-out real samples. The final classification of all real samples is achieved through an ensemble method that averages the raw output logits from the best-performing model of each fold. Model interpretability is provided by generating Grad-CAM heatmaps, which are overlaid on the ECT images to visualize the key morphological features used by the model for classification.
